DO $$
BEGIN
   IF NOT EXISTS (SELECT FROM pg_roles WHERE rolname = 'connectdb') THEN
CREATE ROLE connectdb WITH LOGIN PASSWORD 'connectdb';
END IF;
END$$;

ALTER DATABASE connectdb OWNER TO connectdb;
\connect connectdb
ALTER SCHEMA public OWNER TO connectdb;
SET ROLE connectdb;

CREATE TABLE IF NOT EXISTS users (
                                     username     VARCHAR(255) PRIMARY KEY,
    email        VARCHAR(255) NOT NULL,
    password     VARCHAR(255) NOT NULL,
    created_at   TIMESTAMP DEFAULT NOW(),
    is_admin     BOOLEAN DEFAULT FALSE
    );

CREATE TABLE IF NOT EXISTS posts (
                                     id               BIGSERIAL PRIMARY KEY,
                                     content          TEXT,
                                     likes_count      INT DEFAULT 0,
                                     file_data        BYTEA,
                                     file_name        VARCHAR(255),
    posted_on        TIMESTAMP DEFAULT NOW(),
    author_username  VARCHAR(255) REFERENCES users(username)
    );

CREATE TABLE IF NOT EXISTS likes (
                                     post_id   BIGINT REFERENCES posts(id) ON DELETE CASCADE,
    username  VARCHAR(255) REFERENCES users(username) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT NOW(),
    PRIMARY KEY (post_id, username)
    );

CREATE TABLE IF NOT EXISTS comments (
                                        id         BIGSERIAL PRIMARY KEY,
                                        post_id    BIGINT REFERENCES posts(id) ON DELETE CASCADE,
    username   VARCHAR(255) REFERENCES users(username) ON DELETE SET NULL,
    content    TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
    );

CREATE TABLE IF NOT EXISTS bookmarks (
                                         username   VARCHAR(255) REFERENCES users(username) ON DELETE CASCADE,
    post_id    BIGINT REFERENCES posts(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT NOW(),
    PRIMARY KEY (username, post_id)
    );

CREATE INDEX IF NOT EXISTS idx_users_email            ON users (email);
CREATE INDEX IF NOT EXISTS idx_posts_author_username  ON posts (author_username);
CREATE INDEX IF NOT EXISTS idx_posts_posted_on        ON posts (posted_on);
CREATE INDEX IF NOT EXISTS idx_comments_post          ON comments (post_id);
CREATE INDEX IF NOT EXISTS idx_likes_post             ON likes (post_id);
CREATE INDEX IF NOT EXISTS idx_bookmarks_user         ON bookmarks (username);

ALTER TABLE users     OWNER TO connectdb;
ALTER TABLE posts     OWNER TO connectdb;
ALTER TABLE likes     OWNER TO connectdb;
ALTER TABLE comments  OWNER TO connectdb;
ALTER TABLE bookmarks OWNER TO connectdb;

INSERT INTO users (username, email, password, is_admin)
VALUES
    ('admin', 'admin@example.com', 'admin', TRUE),
    ('alice', 'alice@example.com', 'alice123', FALSE),
    ('bob',   'bob@example.com',   'bob123',   FALSE)
    ON CONFLICT (username) DO NOTHING;

INSERT INTO posts (content, likes_count, file_data, file_name, posted_on, author_username)
VALUES
    ('Hallo Welt!', 2, NULL, NULL, NOW() - INTERVAL '2 days', 'alice'),
    ('Beitrag von Bob', 0, NULL, NULL, NOW() - INTERVAL '1 days', 'bob'),
    ('Bild-Post von Alice', 1, DECODE('ffd8ffe000104a46494600010101004800480000ffdb004300030202020202030202020303030304060404040404080606050609080a0a090809090a0c0f0c0a0b0e0b09090d110d0e0f101011100a0c12131210130f101010ffdb00430103030304030408040408100b090b1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010ffc00011080064006403012200021101031101ffc4001d000000070101010000000000000000000000040506070809030201ffc4003910000201030303020404020a03010000000102030405110006210712314151081322611432718123c109151624425291a1b1f033628263ffc400190100020301000000000000000000000000020300010405ffc4002411000202020202020203000000000000000001021103211231044113511422233261ffda000c03010002110311003f0045b7f5eadf5db7bfabb6fdba936d5c2aaaa48eb71147225540e31d9c15edc0cfe61e3383c93ae2376cd7da1a2ae82a209ab6dd75a5959e291e5468fb1d246ee0300aab0055721703cf931e587a6f75dfb4316e24b65b2d100ee96691247ecaa52783f2b24285ed20904674ff00db1b6ab668ff00014fbbeb28e2888587f0b4d0c31b100780393cfdc9d0b489c5241782d92505ba6aadd774ba1a5b6ca163fc2465634881cafd44021b95008ff9d0d93d26ddbd59de14f47b6ec357474771cd4c72d40763f87ee23e692d924b1070738273e99d25ee7b0dceaf72c3b64eebb955d0528fc6d634e4318a1523bdd557863ce00f5247beaf8d25ded1b6fa75b9aedb798531ecb76d2b74b1ae1a02638e3eff007e1a677cfa15d2b2febd0d5938ad1427a9766a0d95b8e7db56e996a168d8c6f548d94988383f2cfaa820a96f5656c718d34e395c856404927df0c0e74f2dfc96cdd7bc3705dedf3b436da79de9adea89df8a6851563c818c2aa0049c72589f39d1fe9d6c4b3dd2d1b8b745daa192df69fc1d22d402085a99df019879ede3181cfd43536874722ad88b6cab9a09adb7ab04f534570a71fc594b15ef950e4b823ce38c8d5d7d8778d8bd6ee99d5c3bc6cf472dc2dd4c16ef1c454c85083db574ee3f2ba805bb7c1c30f3c985fa0bd36b66edbb5cabeb68116cd6683f0d17cd394a87504337be58f7b647feba67ee7adb9fc3ef57286edb7ee43fabae59151186668da12de1b8e4282083e720fbe342d72d2ec4cdf2952ec4fea9f4bedbb52e55f41b6ef86e125b9c62372a7f17091dc25871ce7b482508cf92091a8b4d4e48464ed3e323d34b7d42bc01b9dae16f97fbbc9931a9c8f9671e00f41c823ede38d3743d45c9e5a98619640b1879c939ed23c9cfb67fe756ad68d106eb61e864407bb1f7273c7eda3d1d6fca6570e48071939d12b4edadc378543496e996395b092cbf421e7dcff21a3d78daf7bb5dbe5ac32c33ac272eb112703fcdc81c0c7fa73ab4ac273aec4dbd592cb7cac15970a0496554118666c1ed0491ff003a1a4d4bec71a845fa80f5271a1a94d00de26ed867a3d45597086bebdad974bad0d09446a6a7b8b43dbdc09e23c80e0f208c81ce3d74f9b4cfb7adc2e115da82ed6152ee239692b26f9018f382632557db951827d7cea07a0de57bb658e5b0db2ada8e9e7aa15533404a4b23018019811f48e481a977a4d1d5aec5bbdfae7297a5a615356cd21cb390071ee497fbf9fd7471b6232c69b9312eddbc69bfb5572a81592d65146d053426793bfb91aa622d9600770fe1e3ee3568aebd53b6a7496a853d62c223dfb4b1b4aaf95994db9e60a3b87182079f5fd06a86d1cd2c91d5562601a468a670070017c0e3f71a781ded5db8f6e5836d25c90fcbbd5d2e9341f2c28ca5122c6c5bd4f6a385e38fdf47f0a9531337b1125df15412a23a6ab7ee95a4555f202b30c827d72028d5a54de54563f808fed27f52d21b8eebdef3433c814768314eb22e78380042142e7c13aa5d637a68ee561a99eac4826969e79c4670cbfc6c1527d0e0673f7d49d35e2e927c3eee0b083515368b46f659513e6964a59664600903e92922211919c3a2e3f39cdca29c920ada8a354fa6161b047f0ed4574836b5be82bea36f4d59288608c31a910b12e0e3f313820eaa87c64deedbbc7a51d1fdff006b140dfd676f6fc54d4a02ab4a634054f19c878e41cfa83ab45f0f7be2c5ba3a5164b79132c75f6c33aacaa0158640405241fa8ae4afb9c678d50fdffb76fdb73e19efdd3ddd34a941b83a67b9a4ada7a596a94cb2db2a2a3b126540c7f867bcf6e7cfa7beb263c6dc9a7f64f929a688aaaeee2aa8d63af7499a24ed8cb121a319e391ce3cf1823f4f3a2f6bbe41455d134ac7e5b62391738ee4270473a8c25dd9376171276b1e3f6f62744bfb4f575120f9b3127381de7c6b52c2df63d644997628e76aa5a5fc0b98d517b19bb5c966c7715ed1c7823c70719f4e5ff47f0f1d5fdc7b7a9f7159a3a2ada3bbc667a722a601dd2027f3038c1ce460f8e7504f4ab77d36e2d934b53dcff88b7c7f2aa87ccee2cbddc49f6e09e78f62781abd5f099bc1af7b3af3b3a59c493d99d2e34aaef80b149c3a83fe50c0f1e9dda56552c51b4072e52b2a5ddfe067aeb57586aadbb52586299439884d1911bff89412fe33c8fd7435a5f2d5d5bf64b4956d1aba8257b7fc5e0ffc686b37e54fe91297d981bf34720b1ed3e46304ea60b456535a7a3f2e5823ca199fe64b8051c93e07dd718f3e71c9d4282460bcf19f6f07522d48997a62f5d23811552c71c6149010870b938e3eac3727d75bf1ede83ceaa3b1a16e651b76b6b8c727d33c61a4e02f6f1f4fdce74d68ef95b435093d1d43290252bffda956ff006246962db5623b35ee98ba7608a3708c71dcc254fcbee783fb690ecf6d92f173a5a280aa7cf92288bca0f6a1770809c7dce9b0dc6ccfd33ed04a62923951b0c8476e3d08f1fcb4eaa7df3ba692d374db1497ba98ad37b6596e344a4086a1d790eca063b81030460e9a1040f4f52607edee463191f7cea73e8ffc356edeb3ed9de9b8b6b575299b695bd2b3f0a73f32acb890845e460ff088f5e48fd936a12b631ed1757a1dd28dc5b67e152e5d4eb5efbaa96f26c82f566a911f7a414eb4e2430989b2321d5d091c10359a5bf3a9fbd37edce6bceecdc95770a8aced33b390a6503c770503bb1818ce7c0d6d2740364aeddf86ea7da5f8869a196c25911f27e509e90334783e00767fa7d32758c5b7764526e99371db6a6aa4a6b95b68a5aca040ca165f94dfc4420fdbd8e463383a1f164e6e4d8b714b63124a991cf07001cf035f0549eeee2c7079c9f7d28d759a920da715e4d513703769a866a6ee1f42244acafe33cb165f6fa748219491cf6923804606b593d93af45b717f5759ab5bf13d9f879bb9973f9e261daeb8f5c7e619f6d5aef878eb859fa6bbfa96fd5eddd6f962fc256aa12a0c52c60f7f39ce182b631e09d51fe94d5b09ae6626904b0c025551800e08c8e7c7a78d4c5d22d9fd50ea7ef27db9d34daeb74b9431998bd4b0a7a6a38f183513bb9fc818af18fa8e3034bc908cd372e89cb8b2fd27c575de1456b6416f5a59809a21554ee9276b723204bedc678c904e00d0d31f6c7c2df5ae4b2d38dd5bf763d75c23051e6a77a800807c1ed8c02c0e4640f6d0d62fe3f443348ce3b0a8527b7ce3c9d49f718e3a6e91d9609a17f9b735332bb3e17b1646ee001f04718c792468bdb3e1f7a9153df5578b50b352c5ccd2d532968d00193f2d32dea31903ce9c9d49b3da208ec9434b511d45be8ed9551d1490f31b4d1150e093c17fa4923df5a61a614f273d103cb2cf48f2c6a460ae08c7e65238cffae8a09e685a0759be5b46e594a7e64230437edfcb5d659c7cc2446c7bc9638fbe89d731c1cb007dbdce3450953a0a5d0b79a79ab2078a5f9f2cc0fce72980d277b7d43f5183fbeaf0ff00472ef54b5ddf765a2750623b712578a18cb48e61ab63c0cfd44acc47039e06a8a58a01513c2ed2144f988b9cf82c40cfec75727e06778edad8fd72bacbb95d2da26b7d7d2cef2960b1c8aa2564c01ce248081eb83a5665fa4ac1be922cc5d7e3a7a71d32dab73b45cb6aee85aca0aaafb653a4f4060594876920cf71c8fe149193c781c678d64fd46e5ae8efb2ee2a393e5cc6696542abc7d4c4918f51838fd35abbd687e89f5dedb78b0d4a4b7db1daedb16e86b95b55d1e1ac86230494c491dca654484e42f847f51ac95dcef689eed3d4ede86b23b6b31f90954c1a545c67b199400d8e46703230481abf154545b4a9fb1526e53a6fa122ed73aab8d654554ce104f27ce654385ee2393ff7df49cad20fa867b4907257f9ebd49f9d837a6473ae1923e839e39c67fd35ad2fb0dff839f68ee27b2d655048d996b60309edff00082739e7f4fd7db4fcd87f117d40e9b43bc29f62dd16da778d2c743575289fc68e28d989f94c7f2960cc09f3ce460f3a8a92031d0356050cb2388d32dc8239271fedfbeb8a48c9956f23fdbefaa714f4c965dfe93ff4896e9d97b1addb63725be9eef576f5310ac9476492c63f297c0fa9bd0b793ebce74354a926c280c727f5ce86abe2c7f45517e63eae5beef4b24152949534ca8d0c8b4c9f298839ee3c9c3607df3e350bdd2b6c6fb5ef9d3c8aa659ea2d3553d5da676fa5bb5b2ead93e300b236339cebb5144fb67784d66ac861127777c25d4f63b0c3018f63eda6df55e816c179a4dc76a9b1f898fb66038c16539f249e79fd755c145e805de88b64caa055c90be491ebeda235719660e58e4fa6949676fc298044c5e475643d9e700e71feba27511b1e17824ffde34b49c646872d51eed923c24c5d8477a95391e87dbefe356bfe1bb735d21ebaecddeb60ab5a7fc5d4514b7a48c770567228e7661fe56764623ffd739d553b6c4c6465273de41e3d31ededa7b6d6dc57cda97186f9b7abaa296ae98931bc6c436410478e0e1829c1e3206a65576bec0a3637a914d0d93a3bbbefd70b0dbacf764b6d5455f590d3c69255140f972cbcb02724771f5f4d61a57464afd2bfe2271eff00f71e9adbbbfededf3d4ce80d3d3ee26a93b82f1b684d5b153f6c61ea64a62df2fb4e002ccc14fea7c6a84dbbfa327e212ed62a6b94f53b62dd53551966b7d5d6bfcf847a066446407ec09c6b2f899a10835365644e53e8a3f3c121eec823d383c79d09e0852820940fe2996447048391852bc0e7dff96ad06f2fe8f2f89fda9dec363535de25192f6ab94339207b2b1563fa6355d6ff00b72f1b7a596dbb82cb5b6ea90f909574ef11ee5254e3b80cfea33e35be328cd5c5d95ee86e93855000ece47e6cebd8385c839f4f3c1d7a788843dc79247eba011646edee3803c138cea5167a8cc2c992d267d70d8d0d7c11ab7d457bb3ea48d0d1a216dfae4d4151b76d3758e545aca32b1c53701a63c9240f40391fae90ae5353f513a772d44441a9823ee64c65a2950fe507cf6b0c9d35f7b6e8374b15a282798bcf4d2b332f6e7bb03839cfed8d1fe9d545450ef74dbe200f477f8476c0edda04850b46c08e030e467d8907db4a51688952d11a44d322469237fe06272adc8eec78ff004d15ab493bcb2b7764e49604e96f70d02516e2b952a3298e9eae44561c06e4f8d274b4d1f6152e30bfa723d7556dbd86952b672b723bd4121bb958e700633c6ad47c10f418f583aa9495b76b724fb676d14b85c8c9ff008e471cc3011ebdcc3247f954fbeab4d9add34d324312b48ccfdaa072493e00fbfdb5b2ff0007bd238ba3bd1ea1b45451a2ddae2df8fb948abcb4ae010a4faf62e171ef9f7d65f2e7f1c35ec2c6edd131ddeb2a686d8d35badf25648802a430819fdbd00fb7db5403e243a9df1bfb396e5bf16db73db7b4286411ac9dd491f68660aaec88cd210491e7dfc6b41abee31dbe079eb1a38624058b7b281924eb2ffe35be2964ea8daeebd31b5c334341437777158b2158aba0880ec01300e7b89273ec31acbe1c5ca5fd6d13334bd8c887fa49be2328e310cb2d8ab3b005ee9a85bb8e07a90e39fbea38ebb7c5f7543af5b4e8765eeca0b153505154a552b525215919c640fad98f6af2781807d73a866a08202a9ee2dc01ff007f6d27cfddd9819201c0f4e06baab1634ed21761697113170bf4f8f3c78d722a149765ef45209c633fa6bbca14aa7a85e42e7c9d71ed666218050064aff9bf5f6f4d1d5b26ba3e23851866e73c95f07435de3108401d581fb36868aca244dc27b2ae761e519803fb674b1639e6a7aadb3748dffbc4354f1a160080aac31e7dbb8e868691d0f695a1bd3ff78a89a797ea766672dee73c9d7b86247a78dd86727c7ff3a1a1ab6f45248b2bf029b1f6eef3eb7532dfe90cf15a682a2e34f164767cf8c0ec660473da5b23ee06b55e5a892db6c54a50aa20a5ee5c8f242fae8686b9de5ef224cb86acca2f899ebbf576bba9db8ada37f5e29686294c51d252d53c5122607d2003e3f7d569bbd7555c5e392ae669244c65d98966fa89c927d743435d4c2925a324b6841a840f34887c119fe7a2322ab29908009f6fd343435631054b1916366e0e5b91f63af05c8a8110c61b927d74343501931e3b768290dae391e10ed233312dcfae3f9686868692fb2cffd9', 'hex'),
     'demo.png', NOW(), 'alice')
    ON CONFLICT DO NOTHING;

ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO connectdb;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT USAGE, SELECT, UPDATE ON SEQUENCES TO connectdb;